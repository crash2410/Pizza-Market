import styles from './Search.module.scss';
import debounce from 'lodash.debounce';
import {useCallback, useContext, useRef, useState} from "react";
import {SearchContext} from "../../App";

function Search() {
    const [value, setValues] = useState('');
    const {setSearchValue} = useContext(SearchContext);
    const inputRef = useRef(null);

    const onClickClear = () => {
        setSearchValue('');
        setValues('');
        inputRef.current.focus();
    }

    // eslint-disable-next-line react-hooks/exhaustive-deps
    const upDateSearchValue = useCallback(
        debounce((str) => {
            setSearchValue(str)
        }, 1000),
        []
    )

    const onChangeInput = event => {
        setValues(event.target.value);
        upDateSearchValue(event.target.value);
    }

    return (
        <div className={styles.root}>
            <svg
                className={styles.icon}
                version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 512 512"
            >
                <g>
                    <g>
                        <g>
                            <path
                                d="M320,0c-86.654,0-160.003,57.732-183.806,136.723l-79.09,79.079c-9.167,9.167-14.438,21.875-14.438,34.865 c0,12.99,5.271,25.698,14.438,34.854l55.813,55.813L3.125,451.125c-4.167,4.167-4.167,10.917,0,15.083l42.667,42.667 c2.083,2.083,4.813,3.125,7.542,3.125c2.729,0,5.458-1.042,7.542-3.125l109.792-109.792l55.354,55.354 c18.479,18.458,50.458,19.344,69.854,1.938l97.082-86.862C462.733,340.728,512,272.04,512,192C512,86.135,425.875,0,320,0z M281.646,440.49c-11.25,10.094-29.813,9.594-40.542-1.135l-62.896-62.896c-4.167-4.167-10.917-4.167-15.083,0L53.333,486.25 L25.75,458.667l109.792-109.792c4.167-4.167,4.167-10.917,0-15.083l-63.354-63.365C66.979,265.24,64,258.031,64,250.667 c0-7.365,2.979-14.573,8.188-19.771l56.716-56.716C128.359,180.055,128,185.984,128,192c0,105.865,86.125,192,192,192 c9.255,0,18.288-0.883,27.198-2.155L281.646,440.49z M320,362.667c-94.104,0-170.667-76.563-170.667-170.667 S225.896,21.333,320,21.333S490.667,97.896,490.667,192S414.104,362.667,320,362.667z"/>
                            <path
                                d="M459.417,155.49c-5.313-5.458-10.792-11.104-12.792-15.938c-2.188-5.26-2.354-13.427-2.521-21.323 c-0.271-13.594-0.583-28.99-10.958-39.365s-25.792-10.698-39.375-10.979c-7.896-0.167-16.063-0.333-21.313-2.51 c-4.854-2.01-10.5-7.49-15.979-12.792C346.542,42.938,335.271,32,320,32s-26.542,10.938-36.479,20.583 c-5.479,5.302-11.125,10.781-15.979,12.792c-5.25,2.177-13.417,2.344-21.313,2.51c-13.583,0.281-29,0.604-39.354,10.979 c-10.375,10.365-10.708,25.781-10.979,39.375c-0.167,7.896-0.354,16.052-2.521,21.302c-2,4.844-7.479,10.49-12.792,15.948 C170.938,165.438,160,176.719,160,192s10.938,26.563,20.583,36.51c5.313,5.458,10.792,11.104,12.792,15.938 c2.188,5.26,2.354,13.427,2.521,21.323c0.271,13.594,0.583,28.99,10.958,39.365s25.792,10.698,39.375,10.979 c7.896,0.167,16.063,0.333,21.313,2.51c4.854,2.01,10.5,7.49,15.979,12.792C293.458,341.063,304.729,352,320,352 s26.542-10.938,36.479-20.583c5.479-5.302,11.125-10.781,15.979-12.792c5.25-2.177,13.417-2.344,21.313-2.51 c13.583-0.281,29-0.604,39.354-10.979c10.375-10.365,10.708-25.781,10.979-39.375c0.167-7.896,0.354-16.052,2.521-21.302 c2-4.844,7.479-10.49,12.792-15.948C469.063,218.563,480,207.281,480,192S469.063,165.438,459.417,155.49z M444.104,213.656 c-6.688,6.896-13.604,14.021-17.188,22.625c-3.708,8.969-3.917,19.167-4.125,29.031c-0.208,10.042-0.438,20.427-4.75,24.74 c-4.313,4.302-14.688,4.521-24.729,4.729c-9.854,0.208-20.063,0.427-29.021,4.135c-8.625,3.573-15.75,10.5-22.667,17.198 c-7.375,7.156-15,14.552-21.625,14.552s-14.25-7.396-21.625-14.552c-6.917-6.698-14.042-13.625-22.667-17.198 c-8.958-3.719-19.167-3.927-29.021-4.135c-10.063-0.208-20.438-0.427-24.75-4.729c-4.292-4.302-4.521-14.688-4.729-24.729 c-0.208-9.865-0.417-20.073-4.125-29.052c-3.583-8.594-10.5-15.719-17.188-22.615c-7.146-7.385-14.563-15.021-14.563-21.656 s7.417-14.271,14.563-21.656c6.688-6.896,13.604-14.021,17.188-22.625c3.708-8.969,3.917-19.167,4.125-29.031 c0.208-10.042,0.438-20.427,4.75-24.74c4.313-4.302,14.688-4.521,24.729-4.729c9.854-0.208,20.063-0.427,29.021-4.135 c8.625-3.573,15.75-10.5,22.667-17.198c7.375-7.156,15-14.552,21.625-14.552s14.25,7.396,21.625,14.552 c6.917,6.698,14.042,13.625,22.667,17.198c8.958,3.719,19.167,3.927,29.021,4.135c10.063,0.208,20.438,0.427,24.75,4.729 c4.292,4.302,4.521,14.688,4.729,24.729c0.208,9.865,0.417,20.073,4.125,29.052c3.583,8.594,10.5,15.719,17.188,22.615 c7.146,7.385,14.563,15.021,14.563,21.656S451.25,206.271,444.104,213.656z"/>
                            <path
                                d="M256,149.333c11.771,0,21.333-9.573,21.333-21.333s-9.563-21.333-21.333-21.333S234.667,116.24,234.667,128 S244.229,149.333,256,149.333z"/>
                            <circle
                                cx="416" cy="202.667" r="10.667"/>
                            <circle cx="309.333" cy="288" r="10.667"/>
                            <circle cx="309.333" cy="96"
                                    r="10.667"/>
                            <path
                                d="M352,213.333c-17.646,0-32,14.354-32,32c0,17.646,14.354,32,32,32c17.646,0,32-14.354,32-32 C384,227.688,369.646,213.333,352,213.333z M352,256c-5.875,0-10.667-4.781-10.667-10.667c0-5.885,4.792-10.667,10.667-10.667 s10.667,4.781,10.667,10.667C362.667,251.219,357.875,256,352,256z"/>
                            <path
                                d="M362.667,106.667c-23.917,0-42.667,14.458-42.667,32.927c0,17.552,8.917,22.719,15.688,24.115 c-0.25,1.25-0.396,2.479-0.396,3.708c0,11.844,8.583,24.583,27.396,24.583c18.792,0,27.354-12.74,27.354-24.583 c0-1.229-0.146-2.458-0.396-3.708c6.771-1.396,15.688-6.563,15.688-24.115C405.333,121.125,386.583,106.667,362.667,106.667z M377.979,140.063c-3.375,0-7.979,2.229-9.979,4.938c-4.333,5.854-2.229,12.833-0.354,18.99c0.458,1.469,0.938,2.875,1.063,3.427 c0,0.969,0,3.25-6.063,3.25c-6.021,0-6.021-2.281-6.042-2.74c0.146-1.063,0.625-2.469,1.083-3.938 c1.875-6.156,3.979-13.135-0.354-18.99c-2-2.708-6.604-4.938-9.979-4.938c-2.396,0-4.375,0.438-6,1.094 c-0.021-0.625-0.021-1.198-0.021-1.563c0-5.469,9.125-11.594,21.333-11.594S384,134.125,384,139.594c0,0.375,0,0.99,0.063,1.594 C382.417,140.521,380.417,140.063,377.979,140.063z"/>
                            <path
                                d="M282.979,198.958c0.25-1.25,0.396-2.479,0.396-3.708c0-11.844-8.583-24.583-27.396-24.583 c-18.792,0-27.354,12.74-27.354,24.583c0,1.229,0.146,2.458,0.396,3.708c-6.771,1.396-15.688,6.563-15.688,24.115 c0,18.469,18.75,32.927,42.667,32.927s42.667-14.458,42.667-32.927C298.667,205.521,289.75,200.354,282.979,198.958z M256,234.667c-12.208,0-21.333-6.125-21.333-11.594c0-0.375,0-0.99-0.063-1.594c1.646,0.667,3.646,1.125,6.083,1.125 c3.375,0,7.979-2.229,9.979-4.938c4.333-5.854,2.229-12.833,0.354-18.99c-0.458-1.469-0.938-2.875-1.063-3.427 c0-0.969,0-3.25,6.063-3.25c6.021,0,6.021,2.281,6.042,2.74c-0.146,1.063-0.625,2.469-1.083,3.938 c-1.875,6.156-3.979,13.135,0.354,18.99c2,2.708,6.604,4.938,9.979,4.938c2.396,0,4.375-0.438,6-1.094 c0.021,0.625,0.021,1.198,0.021,1.563C277.333,228.542,268.208,234.667,256,234.667z"/>
                        </g>
                    </g>
                </g>
            </svg>
            <input ref={inputRef}
                   value={value}
                   onChange={onChangeInput}
                   className={styles.input}
                   placeholder="Поиск пиццы..." type="text"/>
            {value !== '' &&
                <svg onClick={() => onClickClear()}
                     className={styles.icon_clear}
                     fill="#000000" width="800px" height="800px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M7.004 23.087l7.08-7.081-7.07-7.071L8.929 7.02l7.067 7.069L23.084 7l1.912 1.913-7.089 7.093 7.075 7.077-1.912 1.913-7.074-7.073L8.917 25z"/>
                </svg>
            }
        </div>
    )
}

export default Search;